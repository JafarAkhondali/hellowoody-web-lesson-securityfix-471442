<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>vue3-watch模拟真实的使用场景</title>
        <script src="https://unpkg.com/vue@3"></script>
    </head>
    <body>
        <div id="app"></div>
    </body>
</html>
<script>

const getData = () => {
    return new Promise(function(resolve,reject){
        // 通过setTimeout模拟网络的延迟
        setTimeout(() => {
            resolve(["a","b","c"])
        },1000)
    })
}

const Main = {
    setup(){
        
        const list = Vue.ref([])
        const page = Vue.ref(1)
        console.log(1000)
        getData().then(res => {
            console.log(3000)
            list.value = res
        })
         console.log(2000)

        const load = () => {
            console.log("加载更多数据")
            page.value++
            // getData().then(res => {
            //     console.log(3000)
            //     list.value = list.value.concat(res)
            // })
        }
        // watch侦听 被动执行 -> "懒"执行
        Vue.watch(page,(current) => {
            console.log("下一页:",current)
            getData().then(res => {
                console.log(3000)
                list.value = list.value.concat(res)
            })
        })

        return {
            list,
            load
        }
    },
    template:`
        <h1>vue3-watch模拟真实的使用场景</h1>
        <div v-for="item in list">
            {{item}}    
        </div>
        <button @click="load">加载更多</button>
    `
}
const app = Vue.createApp(Main)
app.mount("#app")
</script>