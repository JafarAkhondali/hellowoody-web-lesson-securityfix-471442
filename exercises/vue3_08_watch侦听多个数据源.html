<!DOCTYPE html>
<html>
    <head>
        <title>watch 侦听</title>
        <script src="https://unpkg.com/vue@next"></script>
    </head>
    <body>
        <div id="app">
            {{a}} {{b}} {{c}}
            <button @click="change">改变</button>
            <hr>
            {{numbers}}
        </div>
    </body>
</html>
<!-- 当页面中script标签行内的type属性是module时，页面要正常打开或访问有了一个限制，这个页面必须要被“发布”，要通过http链接访问才行 -->
<!-- <script type="module"> -->
<!-- import {ref,reactive,watch} from "https://unpkg.com/vue@3.2.8/dist/vue.global.js" -->
<script>
Vue.createApp({
    setup(){
        const a = Vue.ref(0)
        const b = Vue.ref(10)
        const c = Vue.ref(100)

        Vue.watch([a,b,c],(newVal,preVal) => {
            console.log(newVal,preVal)
        })

        // setTimeout(() => {
        //     a.value += 1
        //     b.value += 1
        //     c.value += 1
        // },2000)

        // 解释:利用了js异步中的宏任务(macro task)和微任务(micro task)的执行顺序或是执行时间差
        // 宏任务(macro task):回调函数  setTimeout 
        // 微任务(micro task):nextTick() async await
        const change = async () => {
            a.value += 1
            await Vue.nextTick();
            b.value += 1
            await Vue.nextTick();
            c.value += 1
            await Vue.nextTick();
        }

        /*
        浅拷贝使用方式
        let target = []
        // Object.assign(target,[1,2,3]) //浅拷贝
        target = Object.assign([],[1,2,3]) //浅拷贝
        console.log(target) // [1,2,3]
        */

        const numbers = Vue.reactive([1,2,3,4,5]);
        // vue3 侦听数组，如果你想侦听整个数组的增加或减少的话，你要在第一个参数返回值中，用到浅拷贝
        // 浅拷贝
        // Vue.watch(() => Object.assign([],numbers),(v1,v2) => {
        //     console.log(v1,v2)
        // })
        // 浅拷贝的语法糖
        // Vue.watch(() => [...numbers],(v1,v2) => {
        //     console.log(v1,v2)
        // })
        // Vue.watch(() => numbers[2],(v1,v2) => {
        //     console.log(v1,v2)
        // })
        Vue.watch(() => [numbers[1],numbers[2]],(v1,v2) => {
            console.log(v1,v2)
        })
        // vue3 侦听数组，如果你想侦听数组中某一个值的话，那就在第一个参数的返回值中直接返回你需要监控的值
        setTimeout(() => {
            // numbers.push(6)
            numbers[1] = 20
            numbers[2] = 300
        },2000)

        return {
            a,
            b,
            c,
            numbers,
            change
        }
    }
}).mount("#app")
</script>